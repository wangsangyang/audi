<!DOCTYPE HTML>
<html class="scroll">
<head lang="en">
    <meta name="format-detection" content="telephone=no" />
    <meta name="format-detection" content="email=no">
    <meta http-equiv="Content-Type" charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <title>奥迪中国新闻中心</title>
    <link rel="stylesheet" type="text/css" href="css/mystyle.css" />
</head>
<body>

<div class="page page-imagery">
    <header class="page-header">
        <img class="icon-menu" src="images/icon-nav.png" alt="菜单">
        <img class="logo" src="images/logo.png" alt="奥迪logo">
        <img class="icon-search" src="images/icon-search.png" alt="搜索">
        <div class="searchbox">
            <i class="iconclose"></i>
            <div class="search-cont">
                <span class="tips">开始搜索</span>
                <dl class="list">
                    <dt class="search-input"><input id="search" type="text" placeholder="请输入影像标题"></dt>
                    <dd class="search-btn"></dd>
                </dl>
            </div>
        </div>
    </header>

    <div class="page-body">
        <div class="con-condition">
            <dl class="dropSelect" id="carShowSelect">
                <dt class="drop-btn"><span class="text">车展集锦</span><i class="icon-down"></i></dt>
                <dd class="drop-menu">
                    <a class="menu">车展1</a>
                    <a class="menu">车展2</a>
                    <a class="menu">车展3</a>
                </dd>
            </dl>
            <dl class="dropSelect">
                <dt class="drop-btn"><span class="text">2017</span><i class="icon-down"></i></dt>
                <dd class="drop-menu">
                    <a class="menu" href="#">2016</a>
                    <a class="menu" href="#">2015</a>
                    <a class="menu" href="#">2014</a>
                </dd>
            </dl>

            <div class="moreSelect" id="moreSelect">
                <dl class="more-header">
                    <dt class="more-btn"><span class="text">更多筛选条件</span><i class="icon-down"></i></dt>
                </dl>
                <div class="more-body">
                    <div class="item">
                        <dl class="list">
                            <dt class="drop-btn"><span class="text">请选择活动名称</span><i class="icon-down"></i></dt>
                            <dd class="drop-menu">
                                <a class="menu" href="#">上海活动</a>
                                <a class="menu" href="#">北京活动</a>
                            </dd>
                        </dl>
                        <dl class="list">
                            <dt class="drop-btn"><span class="text">请选择素材类型</span><i class="icon-down"></i></dt>
                            <dd class="drop-menu">
                                <a class="menu" href="#">视频类型</a>
                                <a class="menu" href="#">图片类型</a>
                            </dd>
                        </dl>
                    </div>
                    <i class="shadow"></i>
                </div>
            </div>

        </div>
        <div class="cont-masonry" id="contMasonry">
            <ul class="showimgvideo2 item">
                <li class="video">
                    <a>
                        <dl>
                            <dt class="videobox" onclick=""><video class="video" onclick="" src="images/video1.mov" preload="auto" poster="images/ex23.png">您的浏览器不支持视频播放</video><i class="iconplay"></i></dt>
                            <dd>e-Tron 国内首秀集锦</dd>
                        </dl>
                    </a>
                </li>
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex9.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex21.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex1.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
            </ul>
            <ul class="showimgvideo item">
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex1.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
                <li class="video">
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex8.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex6.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
                <li>
                    <a>
                        <dl>
                            <dt onclick=""><img src="images/ex6.png"><i class="iconplay"></i></dt>
                            <dd>A3 Sportback</dd>
                        </dl>
                    </a>
                </li>
            </ul>
            <div class="loading"><img src="images/loading.gif"><span>加载中...</span></div>
        </div>
    </div>

</div>

<!-- start 导航菜单 -->
<div class="page page-nav">
    <i class="shadow"></i>
    <div class="cont-logo"><img src="images/logo.png"></div>
    <div class="cont-nav">
        <ul>
            <li><a href="index.html"><span class="icon"><img src="images/icon-home.png"></span>首页</a></li>
            <li><a href="brand.html"><span class="icon"><img src="images/icon-brand.png"></span>品牌</a></li>
            <li><a href="news.html"><span class="icon"><img src="images/icon-news.png"></span>新闻</a></li>
            <li><a href="imagery.html"><span class="icon"><img src="images/icon-imagery.png"></span>影像</a></li>
            <li><a href="live.html"><span class="icon"><img src="images/icon-feature.png"></span>专题</a></li>
            <li><a href="fillInfo.html"><span class="icon"><img src="images/icon-event.png"></span>活动</a></li>
            <li><a href="message.html"><span class="icon"><img src="images/icon-messages.png"></span>留言</a></li>
        </ul>
    </div>
    <div class="cont-user clearfix">
        <span class="icon"><img src="images/icon-user.png" alt="用户头像"></span>
        <span class="username">Enson Hu</span>
    </div>
</div>
<!-- end 导航菜单 -->

<script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>
<script type="text/javascript" src="js/myjs.js"></script>
<script>
    $(function(){
        $('#carShowSelect .drop-menu .menu').on('click',function(){
            alert('在这执行！');
        });
    });
    $(function(){
        /*更多筛选条件*/
        $('#moreSelect .more-header').on('click',function(){
            var $this = $(this);
            var $morebody = $this.closest('#moreSelect').find('.more-body');
            var isOpen = $morebody.hasClass('show');
            $morebody[isOpen?'removeClass':'addClass']('show');
            $('.page')[isOpen?'removeClass':'addClass']('overflow');
        });
        $('#moreSelect').on('click', '.list .drop-btn', function(){
            var $this = $(this);
            var $list = $this.closest('.list');
            var isOpen = $list.hasClass('open');
            $list.find('.drop-menu')[isOpen?'slideUp':'slideDown']();
            $list[isOpen?'removeClass':'addClass']('open');
        });
        $('#moreSelect .more-body .shadow').on('click',function(){
            var $this = $(this);
            var $morebody = $this.closest('#moreSelect').find('.more-body');
            $morebody.removeClass('show');
            $('.page').removeClass('overflow');
        });
    });

    $(function(){
        $('#contMasonry').on('click', 'dt', function(){
            var $this = $(this);
            var myvideo = $this.find('video')[0];
            if( !$this.hasClass('playing') ){
                $this.addClass('playing');
                myvideo.play();
            }else{
                $this.removeClass('playing');
                myvideo.pause();
            }
        });
    });

    $(window).scroll(function(){
        // 当滚动到最底部以上50像素时， 加载新内容
        if ($(document).height() - $(this).scrollTop() - $(this).height()<50) loadMore();
    });

    function loadMore()
    {
        if( !$('#contMasonry .loading').hasClass('show') ){
            $.ajax({
                url: "js/ex.json",
                async: false, //锁住浏览器,执行完毕后执行后面的方法
                beforeSend: function(){
                    $('#contMasonry .loading').addClass('show');
                },
                success: function (result) {
                    var result = JSON.parse(result);
                    shownew(result);
                }
            });
        }
    }

    function shownew(result,type) {
        var $showimgvideo = $('.showimgvideo');
        var $showimgvideo2 = $('.showimgvideo2');
        if(result) {
            var result_count = result.length;
            console.log(result_count);
            $.each(result,function(key,value){
                console.log(key);
                var html = '';

                if(value['type'] == 'img') {
                    html+='<li class="maidian_liaobiao"><a><dl>';
                    html+='<dt class="showinfo"><img src="'+value['imgurl']+'"></dt>';

                    if(value['title']) {
                        html+='<dd>'+value['title']+'</dd>';
                    }
                }else{
                    html+='<li class="video maidian_liaobiao"><a><dl>';
                    html+='<dt onclick=""><video src="'+value['videourl']+'" preload="auto" poster="'+value['imgurl']+'">您的浏览器不支持视频播放</video><i class="iconplay maidian_liaobiao"></i></dt>';

                    if(value['title']) {
                        html+='<dd>'+value['title']+'</dd>';
                    }
                }
                html+='</dl></a></li>';

                if($showimgvideo.height() < $showimgvideo2.height()){
                    $showimgvideo.append(html);
                }else{
                    $showimgvideo2.append(html);
                }

                if(key+1==result_count){
                    setTimeout(function(){
                        maxHeight();
                    },1000);
                }

            });

        }
    }

    function maxHeight(){
        var $showimgvideo = $('.showimgvideo');
        var $showimgvideo2 = $('.showimgvideo2');
        var $showimgvideo_li_last = $showimgvideo.find('li:last');
        if($showimgvideo.height()-$showimgvideo_li_last.height() > $showimgvideo2.height()){
            $showimgvideo2.append($showimgvideo_li_last);
            $showimgvideo_li_last.remove();
            arguments.callee();
        }else{
            $('#contMasonry .loading').removeClass('show');
        }
    }

</script>
</body>
</html>